<html>
<head>
		<script src="snap.svg-min.js"></script>
		<script src="lodash.min.js"></script>
		<script src="d3-selection.min.js"></script>
		<script src="utilities.js"></script>
		<script text="javascript">
			var coords = [[0.1137,0.4606],[0.9885,0.9929],[0.974,0.0021],[0.3927,0.9803],[0.7045,0.5101],[0.4397,0.0031],[0.0009,0.0103],[0.0003,0.8443],[0.3895,0.6453],[0.9982,0.3305],[0.708,0.1832],[0.6998,0.8308],[0.4057,0.3281],[0.9764,0.6792],[0.2086,0.1654],[0.1702,0.688],[0.1459,0.9988],[0.0033,0.2173],[0.5848,0.6671],[0.7896,0.997],[0.8928,0.5013],[0.4979,0.4903],[0.3016,0.4818],[0.5777,0.9835],[0.2575,0.852],[0.6144,0.3405],[0.8827,0.8377],[0.9166,0.1728],[0.0122,0.6052],[0.5058,0.1667],[0.8231,0.3378],[0.6841,0.0107],[0.2716,0.0017],[0.5169,0.8208],[0.7476,0.6634],[0.2336,0.32],[0.357,0.1621],[0.8296,0.0233],[0.0153,0.3624],[0.3819,0.8017],[0.0083,0.9768],[0.1324,0.0587],[0.2588,0.599],[0.121,0.8139],[0.1298,0.2564],[0.5646,0.0029],[0.8555,0.6185],[0.8393,0.734],[0.2547,0.9715],[0.1306,0.5712]] 
			var tcoords = [[0.2101,0.4938],[1.0092,1.0553],[0.9826,0.0422],[0.4143,0.9906],[0.7285,0.5278],[0.4594,0.0374],[0.0298,0.0964],[0.0808,0.8958],[0.4273,0.6479],[1.0895,0.414],[0.7434,0.2221],[0.793,0.8589],[0.4734,0.4073],[1.0114,0.7296],[0.2189,0.2072],[0.2059,0.7124],[0.1757,1.0914],[0.0965,0.2753],[0.6137,0.7471],[0.8183,1.0319],[0.9282,0.5207],[0.586,0.5321],[0.3289,0.5294],[0.6696,0.9943],[0.346,0.9024],[0.7086,0.3781],[0.9606,0.8983],[0.9596,0.2351],[0.0716,0.6351],[0.5083,0.2581],[0.831,0.3647],[0.7474,0.0783],[0.3714,0.0413],[0.5379,0.8541],[0.8301,0.7453],[0.2721,0.4167],[0.4461,0.249],[0.9189,0.0711],[0.0182,0.3897],[0.475,0.8847],[0.0495,1.029],[0.1356,0.1283],[0.3367,0.6149],[0.2146,0.913],[0.1949,0.2788],[0.6104,0.0082],[0.9283,0.6455],[0.8875,0.7692],[0.327,0.9809],[0.1936,0.6174]] 
			var simplices = [[[0,28],[0,35],[0,38],[0,49],[1,26],[2,27],[2,37],[3,23],[3,24],[3,39],[3,48],[4,34],[4,46],[5,29],[5,32],[5,36],[5,45],[6,41],[7,40],[7,43],[8,22],[8,39],[8,42],[9,27],[9,30],[10,25],[10,31],[11,26],[11,33],[11,34],[11,47],[12,21],[12,22],[12,35],[12,36],[13,26],[13,46],[13,47],[14,32],[14,35],[14,36],[14,41],[14,44],[15,24],[15,28],[15,42],[15,43],[15,49],[16,24],[16,40],[16,43],[16,48],[17,38],[17,44],[18,33],[18,34],[19,26],[20,30],[20,46],[22,35],[22,42],[23,33],[24,39],[24,43],[24,48],[26,47],[27,37],[28,49],[29,36],[29,45],[31,37],[31,45],[32,36],[32,41],[33,39],[34,46],[34,47],[35,44],[38,44],[42,49],[46,47]],[[2,27,37],[3,24,39],[3,24,48],[4,34,46],[5,29,36],[5,29,45],[5,32,36],[8,22,42],[11,26,47],[11,34,47],[12,22,35],[13,26,47],[13,46,47],[14,32,36],[14,32,41],[14,35,44],[15,24,43],[15,28,49],[15,42,49],[16,24,43],[16,24,48],[17,38,44],[34,46,47]],[]] 
			console.log(simplices);
			const duration = 1000
			const triangleGradient = (s, x, y, delay) => {


			// setTimeout(() => {
			// 	t.stop().attr({opacity: 1}).animate({opacity: 0}, duration);
			// }, maxDuration + (maxDelay - delay)*2);
			// setTimeout(() => animation(), maxDuration*2 + maxDelay);
			const animation = () => {
				setTimeout(() => { t.stop().attr({opacity: 0}).animate({opacity: 1}, duration); }, delay);
			}
			animation();
		};

		// Perimeter length of any given polygon (points must be in order)
		const perimeter = (p) => {
			const pts = p.node.points;
			const n = pts.length;
			for (i=0, res=0; i < n-1; i++){ res += Math.hypot(pts[i].x-pts[i+1].x, pts[i].y-pts[i+1].y)	}
			res += Math.hypot(pts[0].x-pts[n-1].x, pts[0].y-pts[n-1].y)
			return(res);
		}

		const gradientAnimation = (s) => {
			triangleGradient(s, 0, 3, true, ancho + space *2, 0)
		};

		var v_path = [5, 36, 12, 22, 42, 15, 24, 48]

		window.onload = function () {
			var w = window.innerWidth; 
			var h = window.innerHeight;
			var s = Snap("#svg_complex").attr({ viewBox: `0 0 ${w} ${h}` });
		

			const fade = (o) => {
				return (evt) => { o.animate({ 'opacity': 0.5 }, 100); };
			};
			const unfade = (o) => {
				return (evt) => { o.animate({ 'opacity': 1.0 }, 100); };
			};
			
			// Draw the 3-simplices
			const quad_style = { fill: "red", 'fill-opacity': "0.1", 'pointer-events': "all" };
			var quads = _.map(simplices[2], (quad) => {
				const xy1 = coords[quad[0]], xy2 = coords[quad[1]], xy3 = coords[quad[2]], xy4 = coords[quad[3]];
				return s.polygon(
					xy1[0]*w, xy1[1]*h, 
					xy2[0]*w, xy2[1]*h, 
					xy3[0]*w, xy3[1]*h, 
					xy4[0]*w, xy4[1]*h
				).attr(quad_style);
			});

			// Draw the 2-simplices
			const tri_style = { fill: "yellow", 'fill-opacity': "0.2", 'pointer-events': "all" };
			var triangles = _.map(simplices[1], (tri) => {
				const xy1 = coords[tri[0]], xy2 = coords[tri[1]], xy3 = coords[tri[2]];
				return s.polygon(xy1[0]*w, xy1[1]*h, xy2[0]*w, xy2[1]*h, xy3[0]*w, xy3[1]*h).attr(tri_style);
			});
			_.forEach(triangles, (tri) => {
				tri.hover(fade(tri), unfade(tri));
			});
			triangles[0].attr({ fill: "red" });
			
			// Draw the 1-simplices
			const line_style = { stroke: "blue", 'stroke-width': 2 };
			var edges = _.map(simplices[0], (edge) => {
				const xy1 = coords[edge[0]];
				const xy2 = coords[edge[1]];
				return s.line(xy1[0]*w, xy1[1]*h, xy2[0]*w, xy2[1]*h).attr(line_style);
			});

			// Draw the 0-simplices
			var vertices = _.map(coords, (xy) => {
				return s.circle(xy[0]*w, xy[1]*h, 5);
			}); 

			var s_g = s.g()
			_.forEach(triangles, (tri) => {
				s_g.add(tri);
			});

			const tri_centroid = (tri) => { 
				let mu_x = _.meanBy(tri.node.points, (pt) => { return pt.x });
				let mu_y = _.meanBy(tri.node.points, (pt) => { return pt.y });
				return [mu_x, mu_y];
			};
			var x_vec = _.map(coords, (xy, i) => { return tcoords[i] - xy[0] });
			var y_vec = _.map(coords, (xy, i) => { return tcoords[i] - xy[1] });
			
			// Map the coordinates 
			const t_vert = (i) => { return [tcoords[i][0]*w, tcoords[i][1]*h] }
			var v_transform = _.map(coords, (xy, i) => {
				let v = t_vert(i)
				return [{ cx: v[0], cy: v[1]}, 1000, mina.linear]
			});
			var e_transform = _.map(simplices[0], (e) => {
				let v1 = t_vert(e[0]), v2 = t_vert(e[1])
				return [{ x1: v1[0], y1: v1[1], x2: v2[0], y2: v2[1]}, 1000, mina.linear]
			});
			var t_transform = _.map(simplices[1], (tri) => {
				const xy_t = [ t_vert(tri[0]), t_vert(tri[1]), t_vert(tri[2]) ];
				return [{ points: xy_t.toString() }, 1000, mina.linear]
			});
			var tri_transform = _.map(simplices[1], (tri) => {
				const xy_t = [ t_vert(tri[0]), t_vert(tri[1]), t_vert(tri[2]) ];
				return [{ points: xy_t.toString() }, 1000, mina.linear]
			});
			//let x_diff = tcoords[i][0] - xy[0]
			//let y_diff = tcoords[i][1] - xy[1]
			// { transform: `T${x_diff},${y_diff}`}
			// var v_set = Snap.set(), e_set = Snap.set(), t_set = Snap.set();
			//v_g.add(vertices[0])
			//v_g.add(vertices[1])

			const path_string = (path_array, v_coords) => {
				let pa = _.takeRight(path_array, path_array.length-1);
				let lp = _.map(pa, (i) => { return `L ${v_coords[i][0]*w} ${v_coords[i][1]*h}` });
				return `M ${v_coords[path_array[0]][0]*w}, ${v_coords[path_array[0]][1]*h}` + lp
			}

			console.log(triangles[0])
			let v_set = Snap.set.apply(this, vertices)
			let e_set = Snap.set.apply(this, edges)
			let t_set = Snap.set.apply(this, triangles)
			// v_set.apply(this, vertices)
			// _.forEach(vertices, (v) => { v_set.push(v); });
			//_.forEach(edges, (e) => { e_set.push(e); });
			// _.forEach(triangles, (t) => { t_set.push(t); });

			console.log(vertices.length)
			console.log(v_set);
			console.log(mina.easein)

			s_g.click(() => {
				//console.log(linear_transform);

				// v_set.animate(linear_transform);
				v_set.animate.apply(v_set, v_transform);
				e_set.animate.apply(e_set, e_transform);
				t_set.animate.apply(t_set, t_transform);

				let pstr = path_string(v_path, tcoords);
				console.log(pstr);
				var path = s.path(pstr).attr({ opacity: 0.0}); 
				var pt = s.circle(60,0, 5).attr({ fill: 'red', opacity: 0 });
				pt.clone().attr({ opacity: 1 }).drawAtPath(path, 10000);
				// Snap.animate(0, 1000, (val) => {
				// 	_.forEach(vertices, (v, i) => {
				// 		v.x = v.x + (1/val)*(coords[i][0]-tcoords[i][0])
				// 		v.y = v.y + (1/val)*(coords[i][1]-tcoords[i][1])
				// 	});
				// });
				// _.forEach(vertices, (v, i) => {
				// 	var t_str = `T${tcoords[i][0]},${tcoords[i][1]}`;
				// 	console.log(t_str);
				// 	v.animate({ transform: "T100,100" }, 1000);
				// });

				// _.forEach(triangles, (tri) => {
				// 	//console.log(tri);
				// 	var bbox = tri.getBBox();
				// 	// let center = tri_centroid(tri);
				// 	Snap.animate(0, 360, (val) => {
				// 		tri.transform(`r${val},${bbox.cx},${bbox.cy}`)
				// 	}, 1000);
				// 	// tri.animate({ transform: `r90, ${center[0]}, ${center[1]}` }, 1000);
				// });
			});

			// Assign hover 
			// var quads_g = s.group(quads)
			// quads[0].hover((evt) => {
			// 	quads[0].animate({ 'opacity': 0.5 }, 100);
			// }, () => {
			// 	quads[0].animate({ 'opacity': 1.0 }, 100);
			// });

			// console.log(simplices)
			// Make it so mousing over a triangle makes all other triangles more transparent 
			// const lighten = (p) => { p.animate({ opacity: 0.2 }, 500); };
			// const darken = (p) => { p.animate({ opacity: 1.0 }, 0); };
			// _.forEach(triangles, (tri) => {
			// 	tri.mouseover(() => { 
			// 		_.forEach(triangles, (other_tri) => {
			// 			if (other_tri != tri){ lighten(other_tri) };
			// 		});
			// 		darken(tri)
			// 	});
			// });
			// console.log(d3.select(triangles[0]))
			
			// var path = [26, 9, 21, 19]
			// // edges[15].attr({ stroke: "red", 'stroke-width': 2});
			// var e_len = edges[15].getTotalLength();
			// var pulse_width = e_len*0.15;
			// // edges[15].attr({ 
			// // 	'stroke-dasharray': `${0.50*e_len}`, 
			// // 	'stroke-dashoffset': `${-e_len*0.10}`
			// //  });
			// //edges[15].hover(() => {
			// console.log(edges[15]);
			// var edge = edges[15];
			// var xy1 = coords[simplices[0][15][0]]
			// var xy2 = coords[simplices[0][15][1]]
			// //var g_str = `l(${xy1[0]}, ${xy1[1]}, ${xy2[0]}, ${xy2[1]})#000-#f00`
			// var gray = "#C0C0C0", silver = "#D3D3D3", red = "#ff0000"
			// var init_g = s.gradient(`l(0, 0, 1, 1)${gray}-${silver}-${gray}`);
			// var pulse_start = s.gradient(`l(0, 0, 1, 1)${red}-${silver}-${gray}`);
			// var pulse_mid = s.gradient(`l(0, 0, 1, 1)${gray}-${red}-${gray}`);
			// // var g = s.gradient("l(1, 1, 0, 0)#C0C0C0-#D3D3D3-#C0C0C0");
			// //var g = s.gradient("r(0, 0, 1)#ff0000:5-#C0C0C0");
			// // var g = s.gradient(g_str);
			// var my_line = s.line(0, 0, 300, 300);
			// my_line.attr({ 'stroke': init_g, 'stroke-width': 20 });
			
			// const pulse = (edge) => {
			// 	edge.attr({ 'stroke': pulse_start });
			// 	Snap.animate(0, 50, function(step){
			// 		Snap( pulse_start.node.childNodes[0] ).attr('offset', `${step}%`);
			// 	}, 1000, () => {
			// 		Snap( pulse_start.node.childNodes[0] ).attr('stop-color', `${gray}`);
			// 		Snap( pulse_start.node.childNodes[1] ).attr('stop-color', `${red}`);
			// 	});
				

			// 	// pulse_start.attr({ x1: 0, y1: 0, x2: 0, y2: 0 });
			// 	// pulse_start.animate({ x1: 0, y1: 0, x2: 1, y2: 1 }, 200, mina.linear, ()=>{
			// 	// 	edge.attr({ 'stroke': pulse_mid });
			// 	// });
				
			// 	// pulse_start.attr({ x1: 0, y1: 0, x2: 0, y2: 0 });
			// 	// pulse_start.animate({ x1: 0, y1: 0, x2: 1, y2: 1 }, 200, mina.linear);
			// }
			// my_line.hover(() => {
			// 	//my_line
			// 	pulse(my_line)
			// 	// my_line.animate({ 'offset': 100}, 1000)
			// 	// console.log(pulse_start);
			// 	// Snap.animate(0, 100, function(step){
			// 	// 	// console.log(step);
			// 	// 	Snap( pulse_start.node.childNodes[0] ).attr('offset', `${step}%`);
			// 	// }, 1000);
			// });
			

			// NOTE TO TRY: SWAP THE ENDCOLORS AT 50%! 
			// Snap.animate(0, 100, function( val ) {
			// 	//var rgb = 'rgb(' + parseInt(val[0]) + ',' + parseInt(val[1]) + ',' + parseInt(val[2]) + ')'
			// 	// Snap( g.node.childNodes[0] ).attr('stop-color', rgb);
			// 	//Snap( g.node.childNodes[0] ).attr('offset', `${-val}%`);
			// 	Snap( g.node.childNodes[1] ).attr('offset', `${val}%`);
			// 	// Snap( g.node.childNodes[1] ).attr('stop-color', rgb);
			// 	// Snap( g.node.childNodes[0] ).attr('stop-color', rgb);
			// }, 1000);
			// console.log(Snap(g.node.childNodes[0]).attr())
			//my_line.animate({ 'stroke': g, 'stroke-width': 20 }, 1000, mina.easein);
			// edge.animate({ 'stroke': g, 'stroke-width': 10 }, 1000);
			// function wave(){
			// 	edge.animate({ 'stroke': g }, 1000, mina.linear, wave)
			// }
			// wave()
			// edge.animate({ 
			// 	'stroke-dasharray': `${0.50*e_len}`,
			// 	'stroke-dashoffset': `${-e_len*0.50}`,
  		// 	'animation': 'dash 5s linear forwards'
			// }, 100);
			// //});
			
			// console.log(edges[0].getTotalLength());
			// // Math.abs(edge.node.x1.baseVal.value-edge.node.x2.baseVal.value)
			

			// const face_style = { 
			// 	fill: "#f1f1f1",
			// 	stroke: "#b8b8b8", strokeOpacity: 1, strokeWidth: 5
			// }
			// triangles[0].attr(face_style)

			// const triangle = s.polygon(55, 5, 5, 100, 100, 100).attr(face_style);
			// const p_len = triangles[0].getTotalLength();
			// triangle.attr({ 'stroke-dasharray': p_len*0.50 });
			// triangle.animate({ 'stroke-dashoffset': 0 }, 500, () => {
			// 	triangle.animate({ 'stroke-dashoffset': p_len }, 500)
			// });
			// console.log(triangle)

			// Simple circle
			// var my_circle = s.circle(w/2, h/2, 100);
			// my_circle.hover((evt) => {
			// 	my_circle.animate({ 'opacity': 0.5 }, 100);
			// }, () => {
			// 	my_circle.animate({ 'opacity': 1.0 }, 100);
			// });

			// my_circle.animate({'opacity': 0.5}, 1000);

			// my_circle.animate({ fill: "red" }, 2000);
			//var bigCircle = s.circle(150, 150, 100);
			//var smallRect = Snap.rect(180, 30, 50, 40);
			//var gradient = Snap.gradient('r()#fff-#000');
			
			// mask.attr('fill', gradient);

			// const pulse = (p, duration=500) => {
			// 	p.animate({ opacity: 0.2 }, duration, () => {
			// 		p.animate({ opacity: 0.8 }, duration);
			// 	});
			// }
			// triangle.hover(() => {
			// 	pulse(triangle)
			// 	// setInterval(() => { pulse(triangle) }, 1000)
			// });
			//setInterval(() => { pulse(triangle) }, 1000)


			// const triangle2 = triangle.clone().transform("t150");
			// triangle.animate({
			// 	transform: triangle2.matrix
			// }, 2500);
			// console.log(triangle)


			// triangle.animate({ 
			// 	transform: "r45"
			// }, 5000);
			//triangle.transform("r45");


			//https://codepen.io/ijpiantanida/pen/VMzrdO
			// By default its black, lets change its attributes
			// circle.attr({
			// 		fill: "#0000ff",
			// 		stroke: "#fff",
			// 		strokeWidth: 2, 
			// 		opacity: 0.2
			// });
			// var gradientRadial = SNPsvg.gradient("r(0.5, 0.5, 0.5)#000-#fff");
			// s.hover(

			// )
			// circle.hover(addBlur);
			// circle.attr({fill: "r()#fff-#000"});
		}
		</script>
</head>
<body>
	<svg id="svg_complex" width="100%" height="100%"></svg>
</body>
</html>